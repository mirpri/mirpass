import{u as A,a as R,A as $,b as U,r as d,j as e,R as D,B as u,d as y}from"./index-BgHobQkF.js";import{C as N}from"./index-BELaRMtZ.js";import{T as E}from"./index-CpYTIEz2.js";import{S as T}from"./TextArea-DDzZaqeS.js";import{D as z}from"./index-CQoQ_nUP.js";import{R as P}from"./UserOutlined-CBI5NnIO.js";const{Title:w,Text:t}=E;function q(){const c=A(),[x]=R(),{message:m}=$.useApp(),{ssoSessionId:f,setSsoSessionId:n,ssoDetails:s,fetchSsoDetails:S,ssoConfirm:b,profile:p,token:l,logout:C}=U(),o=x.get("sso"),r=x.get("from"),a=o||f,[v,h]=d.useState(!1);d.useEffect(()=>{o&&o!==f&&n(o)},[o,f,n]),d.useEffect(()=>{if(!l&&a){const i=r?`&from=${encodeURIComponent(r)}`:"";c(`/login?sso=${a}${i}`,{replace:!0})}else a||c("/dashboard",{replace:!0})},[l,a,r,c]),d.useEffect(()=>{a&&l&&S().catch(()=>{m.error("Failed to fetch SSO details"),n(null),c("/dashboard")})},[a,l]);const k=async()=>{if(a){h(!0);try{const i=await b(!!r);if(n(null),m.success(`Logged in to ${s?.appName}`),r){let g=r;const j=i?.authCode;if(j){const I=r.includes("?")?"&":"?";g+=`${I}code=${encodeURIComponent(j)}`}setTimeout(()=>{window.location.href=g},500)}}catch{m.error("Failed to confirm login")}finally{h(!1)}}};return!a||!s?null:s.status==="confirmed"?e.jsx(N,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"text-6xl text-green-500 mb-4"}),e.jsx(w,{level:3,children:"Success!"}),e.jsxs(t,{className:"block mb-6",children:["You have logged in to ",s.appName,".",e.jsx("br",{}),"You can close this window now."]}),e.jsx(u,{type:"default",onClick:()=>window.close(),children:"Close Window"})]})}):e.jsx(N,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs(T,{orientation:"vertical",size:"large",className:"w-full text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(y,{size:64,src:s.logoUrl,style:{margin:"10px"},children:s.appName.charAt(0).toUpperCase()}),e.jsx(w,{level:3,className:"m-0",children:s.appName}),e.jsx(t,{type:"secondary",children:"wants to access your account"})]}),e.jsx(z,{className:"my-2"}),e.jsxs("div",{className:"text-left bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4 rounded-lg",children:[e.jsx(t,{type:"secondary",className:"text-xs uppercase font-bold tracking-wider",children:"Signed in as"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(y,{src:p?.avatarUrl,icon:e.jsx(P,{})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(t,{strong:!0,children:p?.nickname}),e.jsx(t,{type:"secondary",children:p?.username})]})]})]}),e.jsxs(u,{type:"primary",size:"large",block:!0,onClick:k,loading:v,children:["Continue to ",s.appName]}),e.jsx(u,{type:"text",block:!0,onClick:C,children:"Change Account"})]})})}export{q as default};
