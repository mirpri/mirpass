import{u as I,A as S,r as d,a as b,b as k,c as P,j as e,S as p,B as T,L as h,d as z}from"./index-q3coxKpc.js";import{s as L}from"./crypto-B9Mf35RN.js";import{C as E}from"./index-C6EakQ48.js";import{T as F}from"./index-BnR03HeS.js";import{F as o,I as x}from"./index-BGxdU0Dl.js";import{R,a as N}from"./UserOutlined-BHQRD-uj.js";import"./TextArea-DBS6MHTP.js";const{Title:q,Text:j}=F;function G({isAuthenticated:u}){const{t:s}=I(),{message:t}=S.useApp(),[w,m]=d.useState(!1),n=b(),[i,g]=k(),{ssoSessionId:l,setToken:y}=P();d.useEffect(()=>{u&&(l?n("/auth",{replace:!0}):n("/dashboard",{replace:!0}))},[u,l,n]),d.useEffect(()=>{if(i.get("verified")==="true"){t.success(s("login.email-verified-you-can-log-in-now"));const r=new URLSearchParams(i);r.delete("verified"),g(r,{replace:!0})}},[i,g]);const v=async r=>{m(!0);try{const c={...r,password:await L(r.password)},{data:a}=await z.post("/login",c),f=a?.data?.token;if(!f)throw new Error("Missing token from server response");t.success(a?.message||"Logged in"),y(f)}catch(c){const a=c;t.error(a.response?.data?.error||"Failed to login")}finally{m(!1)}};return e.jsx(E,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs(p,{orientation:"vertical",size:"large",className:"w-full",children:[e.jsxs(p,{orientation:"vertical",size:4,children:[e.jsx(q,{level:3,className:"m-0",children:s("login.login")}),e.jsx(j,{type:"secondary",children:s(l?"login.sign-in-to-continue-to-external-app":"login.login-to-continue-to-your-dashboard")})]}),e.jsxs(o,{layout:"vertical",onFinish:v,requiredMark:!1,children:[e.jsx(o.Item,{label:s("username"),name:"username",rules:[{required:!0,message:s("login.please-enter-your-username")}],children:e.jsx(x,{size:"large",prefix:e.jsx(R,{}),placeholder:"Username"})}),e.jsx(o.Item,{label:"Password",name:"password",rules:[{required:!0,message:s("login.please-enter-your-password")}],children:e.jsx(x.Password,{size:"large",prefix:e.jsx(N,{}),placeholder:"••••••••",autoComplete:"current-password"})}),e.jsx(o.Item,{children:e.jsx(T,{type:"primary",htmlType:"submit",size:"large",block:!0,loading:w,children:s("sign-in")})})]}),e.jsxs(p,{orientation:"vertical",size:4,children:[e.jsxs(j,{type:"secondary",children:[s("login.new-here")," ",e.jsx(h,{to:"/register",children:s("login.create-an-account")})]}),e.jsx(h,{to:"/forget",children:s("login.forgot-password")})]})]})})}export{G as default};
