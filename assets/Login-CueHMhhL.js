import{A as L,r as c,u as b,a as E,b as F,j as e,B as R,L as j,c as $}from"./index-C1qiHovD.js";import{s as k}from"./crypto-B9Mf35RN.js";import{C}from"./index-Cd4gSAcP.js";import{S as p}from"./TextArea-TCOLGvF0.js";import{T as N}from"./index-DsEsYiwj.js";import{F as l,I as w}from"./index-BpHuEX1Q.js";import{R as T,a as U}from"./UserOutlined-BulsyN9J.js";const{Title:q,Text:y}=N;function J({onLogin:S,isAuthenticated:u}){const{message:d}=L.useApp(),[I,f]=c.useState(!1),t=b(),[a,h]=E(),{ssoSessionId:P,setSsoSessionId:g}=F(),n=a.get("sso"),o=a.get("from");c.useEffect(()=>{n&&g(n)},[n,g]);const r=n||P;c.useEffect(()=>{if(u)if(r){const s=o?`&from=${encodeURIComponent(o)}`:"";t(`/authorize?sso=${r}${s}`,{replace:!0})}else t("/dashboard",{replace:!0})},[u,r,o,t]),c.useEffect(()=>{if(a.get("verified")==="true"){d.success("Email verified. You can log in now.");const s=new URLSearchParams(a);s.delete("verified"),h(s,{replace:!0})}},[a,h]);const v=async s=>{f(!0);try{const m={...s,password:await k(s.password)},{data:i}=await $.post("/login",m),x=i?.data?.token;if(!x)throw new Error("Missing token from server response");if(d.success(i?.message||"Logged in"),S(x),r){const z=o?`&from=${encodeURIComponent(o)}`:"";t(`/authorize?sso=${r}${z}`,{replace:!0})}}catch(m){const i=m;d.error(i.response?.data?.error||"Failed to login")}finally{f(!1)}};return e.jsx(C,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs(p,{orientation:"vertical",size:"large",className:"w-full",children:[e.jsxs(p,{orientation:"vertical",size:4,children:[e.jsx(q,{level:3,className:"m-0",children:"Login"}),e.jsx(y,{type:"secondary",children:r?"Sign in to continue to external app":"Login to continue to your dashboard"})]}),e.jsxs(l,{layout:"vertical",onFinish:v,requiredMark:!1,children:[e.jsx(l.Item,{label:"Username",name:"username",rules:[{required:!0,message:"Please enter your username"}],children:e.jsx(w,{size:"large",prefix:e.jsx(T,{}),placeholder:"Username"})}),e.jsx(l.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please enter your password"}],children:e.jsx(w.Password,{size:"large",prefix:e.jsx(U,{}),placeholder:"••••••••",autoComplete:"current-password"})}),e.jsx(l.Item,{children:e.jsx(R,{type:"primary",htmlType:"submit",size:"large",block:!0,loading:I,children:"Sign in"})})]}),e.jsxs(p,{orientation:"vertical",size:4,children:[e.jsxs(y,{type:"secondary",children:["New here? ",e.jsx(j,{to:"/register",children:"Create an account"})]}),e.jsx(j,{to:"/forget",children:"Forgot Password?"})]})]})})}export{J as default};
