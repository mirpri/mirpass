import{i as le,g as ge,m as ye,n as T,C as je,o as we,q as ve,s as W,d as f,b as ke,r as o,c as y,j as e,A as Y,B as m,t as K,L as B,v as J}from"./index-BtQilkke.js";import{I as Ce}from"./antd-img-crop.esm-Ce0_xqPV.js";import{U as Ne,R as Se,f as X,D as be,F as Pe,M as Q}from"./date-Co5zdWE4.js";import{s as G}from"./crypto-Cw3CO9Ve.js";import{F as u,R as Z,C as O,I as C}from"./index-Du-RPus6.js";import{C as ee}from"./index-BTQ6B5bA.js";import{i as se,S as l,R as ae}from"./TextArea-d1BLIjnm.js";import{T as ze,R as V}from"./index-CNaZsIK2.js";import{D as te}from"./index-Ddxff6ue.js";import{s as x}from"./index-xphwZMwG.js";import{K as Ie}from"./key-round-aSuoEubc.js";const ce=["wrap","nowrap","wrap-reverse"],ie=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],oe=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"],Me=(a,t)=>{const r=t.wrap===!0?"wrap":t.wrap;return{[`${a}-wrap-${r}`]:r&&ce.includes(r)}},$e=(a,t)=>{const r={};return oe.forEach(n=>{r[`${a}-align-${n}`]=t.align===n}),r[`${a}-align-stretch`]=!t.align&&!!t.vertical,r},Fe=(a,t)=>{const r={};return ie.forEach(n=>{r[`${a}-justify-${n}`]=t.justify===n}),r},Ee=(a,t)=>le({...Me(a,t),...$e(a,t),...Fe(a,t)}),Ae=a=>{const{componentCls:t}=a;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},Ue=a=>{const{componentCls:t}=a;return{[t]:{"&-gap-small":{gap:a.flexGapSM},"&-gap-middle":{gap:a.flexGap},"&-gap-large":{gap:a.flexGapLG}}}},Le=a=>{const{componentCls:t}=a,r={};return ce.forEach(n=>{r[`${t}-wrap-${n}`]={flexWrap:n}}),r},Re=a=>{const{componentCls:t}=a,r={};return oe.forEach(n=>{r[`${t}-align-${n}`]={alignItems:n}}),r},_e=a=>{const{componentCls:t}=a,r={};return ie.forEach(n=>{r[`${t}-justify-${n}`]={justifyContent:n}}),r},De=()=>({}),qe=ge("Flex",a=>{const{paddingXS:t,padding:r,paddingLG:n}=a,p=ye(a,{flexGapSM:t,flexGap:r,flexGapLG:n});return[Ae(p),Ue(p),Le(p),Re(p),_e(p)]},De,{resetStyle:!1}),H=T.forwardRef((a,t)=>{const{prefixCls:r,rootClassName:n,className:p,style:j,flex:I,gap:g,vertical:M,orientation:U,component:N="div",children:L,...R}=a,{flex:S,direction:$,getPrefixCls:_}=T.useContext(je),h=_("flex",r),[b,P]=qe(h),[,w]=we(U,M??S?.vertical),F=le(p,n,S?.className,h,b,P,Ee(h,a),{[`${h}-rtl`]:$==="rtl",[`${h}-gap-${g}`]:se(g),[`${h}-vertical`]:w}),v={...S?.style,...j};return W(I)&&(v.flex=I),W(g)&&!se(g)&&(v.gap=g),T.createElement(N,{ref:t,className:F,style:v,...ve(R,["justify","wrap","align"])},L)});const Te=[["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}],["path",{d:"M10 4v4",key:"pp8u80"}],["path",{d:"M2 8h20",key:"d11cs7"}],["path",{d:"M6 4v4",key:"1svtjw"}]],re=f("app-window",Te);const Ge=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],Oe=f("circle-user",Ge);const Ve=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],He=f("clock",Ve);const We=[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]],Ye=f("id-card",We);const Ke=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],ne=f("mail",Ke);const Be=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Je=f("plus",Be);const Xe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M8 12h.01",key:"czm47f"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M16 12h.01",key:"1l6xoz"}]],Qe=f("shield-ellipsis",Xe);const Ze=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],es=f("tag",Ze),{Title:ss,Text:i}=ze;function xs(){const{profile:a,myApps:t,fetchMyApps:r,updateProfile:n}=ke(),[p,j]=o.useState(null),[I,g]=o.useState([]),[M,U]=o.useState([]),[N,L]=o.useState(null);o.useEffect(()=>{r(),R()},[]),o.useEffect(()=>{S(N)},[N]);const R=async()=>{try{const{data:s}=await y.get("/user/apps/summary");U(s.data||[])}catch{}},S=async s=>{try{let c="/user/history";if(s){const z=s.format("YYYY-MM-DD"),fe=s.utcOffset();c+=`?date=${z}&offset=${fe}`}const{data:d}=await y.get(c);g(d.data||[])}catch{}},[$,_]=o.useState({avatar:!1,nickname:!1}),[h,b]=o.useState(""),[P,w]=o.useState(""),[F,v]=o.useState(null);o.useEffect(()=>{r()},[]),o.useEffect(()=>{a&&(b(a.nickname||""),w(a.avatarUrl||""))},[a]);const k=(s,c)=>{_(d=>({...d,[s]:c})),s==="nickname"&&b(a?.nickname||""),s==="avatar"&&w(a?.avatarUrl||"")},de=async()=>{const s=h.trim();if(!s){x.warning("nickname cannot be empty");return}j("nickname");try{const{data:c}=await y.post("/profile/nickname",{nickname:s});n({nickname:s}),x.success(c?.message||"nickname updated"),k("nickname",!1)}catch(c){const d=c;x.error(d.response?.data?.message||"Could not update nickname")}finally{j(null)}},me=async()=>{j("avatar");try{let s;if(F){const d=new FormData;d.append("file",F);const{data:z}=await y.post("/profile/avatar",d,{headers:{"Content-Type":"multipart/form-data"}});s=z}else{const d=P.trim(),{data:z}=await y.post("/profile/avatar",{avatarUrl:d});s=z}let c=s.data?.avatarUrl||P;c.startsWith("/blob/")&&J.API_URL&&(c=J.API_URL.replace(/\/$/,"")+c),n({avatarUrl:c}),x.success(s?.message||"Avatar updated"),k("avatar",!1),v(null)}catch(s){const c=s;x.error(c.response?.data?.message||"Could not update avatar")}finally{j(null)}},[pe,D]=o.useState(!1),[E]=u.useForm(),[xe,q]=o.useState(!1),[A]=u.useForm(),he=async()=>{try{const s=await E.validateFields();await y.post("/profile/password",{currentPassword:await G(s.currentPassword),newPassword:await G(s.newPassword)}),x.success("Password updated successfully"),D(!1),E.resetFields()}catch(s){x.error(s.response?.data?.message||"Failed to update password")}},ue=async()=>{try{const s=await A.validateFields();await y.post("/profile/email/change",{password:await G(s.password),newEmail:s.newEmail}),x.success("Verification email sent to new address"),q(!1),A.resetFields()}catch(s){x.error(s.response?.data?.message||"Failed to request email change")}};return a?e.jsxs(ee,{className:"mx-auto max-w-4xl w-full rounded-[18px] bg-white/95 shadow-xl p-8",children:[e.jsx(H,{justify:"space-between",align:"center",wrap:!0,children:e.jsxs(l,{direction:"vertical",size:4,children:[e.jsx(ss,{level:3,className:"m-0",children:"Dashboard"}),e.jsx(i,{type:"secondary",children:"Manage your profile and credentials"})]})}),e.jsx(te,{className:"my-6"}),e.jsxs(Z,{gutter:[24,24],align:"stretch",children:[e.jsx(O,{xs:24,sm:9,children:e.jsxs(l,{direction:"vertical",size:16,className:"w-full p-4",children:[e.jsx(Y,{size:96,src:a?.avatarUrl,className:"shadow-lg",children:a?.username?.charAt(0).toUpperCase()}),e.jsx(i,{strong:!0,className:"text-xl",children:a?.nickname||a?.username||"—"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(l,{align:"center",size:10,children:[e.jsx(Ye,{color:"#5c4bff",size:16}),e.jsx(i,{children:a?.username||"—"})]}),e.jsxs(l,{align:"center",size:10,children:[e.jsx(ne,{color:"#5c4bff",size:16}),e.jsx(i,{children:a?.email||"—"})]})]})]})}),e.jsx(O,{xs:24,sm:15,children:e.jsxs(l,{direction:"vertical",size:32,className:"w-full p-4",children:[e.jsxs("div",{children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(es,{color:"#5c4bff",size:16}),e.jsx(i,{strong:!0,className:"text-base",children:"Nickname"})]}),e.jsx("div",{className:"mt-[14px]",children:$.nickname?e.jsxs(l.Compact,{children:[e.jsx(C,{value:h,onChange:s=>b(s.target.value),placeholder:"Set a nickname",className:"min-w-[190px]"}),e.jsx(m,{type:"primary",icon:e.jsx(ae,{}),loading:p==="nickname",onClick:de}),e.jsx(m,{icon:e.jsx(K,{}),type:"default",onClick:()=>k("nickname",!1)})]}):e.jsxs(l,{align:"center",children:[e.jsx(i,{type:"secondary",children:a?.nickname||"No nickname set"}),e.jsx(m,{type:"link",icon:e.jsx(V,{}),onClick:()=>k("nickname",!0),children:"Update"})]})})]}),e.jsxs("div",{children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(Oe,{color:"#5c4bff",size:16}),e.jsx(i,{strong:!0,className:"text-base",children:"Avatar"})]}),e.jsx("div",{className:"mt-[14px]",children:$.avatar?e.jsxs(l,{children:[e.jsxs(l.Compact,{children:[e.jsx(C,{value:P,onChange:s=>w(s.target.value),placeholder:"https://example.com/avatar.jpg",className:"min-w-[220px]"}),e.jsx(m,{type:"primary",icon:e.jsx(ae,{}),loading:p==="avatar",onClick:me}),e.jsx(m,{icon:e.jsx(K,{}),type:"default",onClick:()=>k("avatar",!1)})]}),e.jsx(Ce,{rotationSlider:!0,children:e.jsx(Ne,{showUploadList:!1,customRequest:({file:s,onSuccess:c})=>{const d=s;v(d),w(URL.createObjectURL(d)),x.info("Image selected. Click check to save."),c?.("ok")},children:e.jsx(m,{icon:e.jsx(Se,{}),children:"Select"})})})]}):e.jsxs(l,{wrap:!0,align:"center",children:[e.jsx(i,{type:"secondary",children:a?.avatarUrl?"Custom URL linked":"No avatar set"}),e.jsx(m,{type:"link",icon:e.jsx(V,{}),onClick:()=>k("avatar",!0),children:"Update"})]})})]}),e.jsxs("div",{children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(ne,{color:"#5c4bff",size:16}),e.jsx(i,{strong:!0,className:"text-base",children:"Email"})]}),e.jsxs("div",{className:"mt-[14px]",children:[e.jsx(i,{type:"secondary",className:"mr-4",children:a?.email||"No Email"}),e.jsx(m,{type:"link",icon:e.jsx(V,{}),onClick:()=>q(!0),className:"pl-0",children:"Change Email"})]})]}),e.jsxs("div",{children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(Ie,{color:"#5c4bff",size:16}),e.jsx(i,{strong:!0,className:"text-base",children:"Password"})]}),e.jsxs("div",{className:"mt-[14px]",children:[e.jsx(m,{type:"link",onClick:()=>D(!0),className:"pl-0",children:"Change Password"}),e.jsx(B,{to:"/forget",className:"ml-4",children:"Forgot Password"})]})]}),e.jsxs("div",{children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(re,{color:"#5c4bff",size:16}),e.jsx(i,{strong:!0,className:"text-base",children:"My Applications"})]}),e.jsxs("div",{className:"mt-[14px]",children:[t.map(s=>e.jsx(B,{to:s.name==="system"?"/manage":`/manage/${s.appId}`,children:e.jsxs(m,{className:"m-1",children:[e.jsx(Qe,{size:14}),s.name]})},s.appId)),e.jsxs(m,{type:"dashed",href:"/apps/create",className:"m-1",children:[e.jsx(Je,{size:14}),"Create New App"]})]})]})]})})]}),e.jsx(te,{className:"my-6"}),e.jsxs(l,{direction:"vertical",style:{width:"100%"},className:"mb-8",children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(re,{color:"#5c4bff",size:16}),e.jsx(i,{strong:!0,className:"text-base",children:"Applications Logged Into"})]}),e.jsxs(Z,{gutter:[16,16],className:"mt-4",children:[M.map(s=>e.jsx(O,{xs:24,sm:12,md:8,lg:6,children:e.jsx(ee,{size:"small",className:"hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(H,{align:"center",gap:10,children:[e.jsx(Y,{src:s.logoUrl,children:s.app.charAt(0).toUpperCase()}),e.jsx(i,{strong:!0,children:s.app})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Last Login: ",e.jsx("br",{}),X(s.time)]})]})})},s.app)),M.length===0&&e.jsx(i,{type:"secondary",className:"pl-4",children:"No login history found."})]})]}),e.jsxs(l,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(H,{justify:"space-between",align:"center",children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(He,{size:16,color:"#5c4bff"}),e.jsx(i,{strong:!0,className:"text-base",children:"Login History"})]}),e.jsx(be,{value:N,onChange:L,placeholder:"Select Date",allowClear:!0})]}),e.jsx(Pe,{dataSource:I,rowKey:s=>s.time+s.app+Math.random(),pagination:{pageSize:5},size:"small",locale:{emptyText:"No history found"},columns:[{title:"Application",dataIndex:"app",key:"appName"},{title:"Time",dataIndex:"time",key:"time",render:s=>X(s)}]})]}),e.jsx(Q,{title:"Change Password",open:pe,onOk:he,onCancel:()=>{D(!1),E.resetFields()},children:e.jsxs(u,{form:E,layout:"vertical",children:[e.jsx(u.Item,{name:"currentPassword",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:e.jsx(C.Password,{})}),e.jsx(u.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please enter a new password"},{min:8,message:"Password must be at least 8 characters"}],children:e.jsx(C.Password,{})})]})}),e.jsx(Q,{title:"Change Email",open:xe,onOk:ue,onCancel:()=>{q(!1),A.resetFields()},children:e.jsxs(u,{form:A,layout:"vertical",children:[e.jsx(u.Item,{name:"newEmail",label:"New Email",rules:[{required:!0,message:"Please enter your new email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(C,{})}),e.jsx(u.Item,{name:"password",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:e.jsx(C.Password,{})})]})})]}):e.jsx("div",{className:"p-10 text-center",children:"Loading Profile..."})}export{xs as default};
