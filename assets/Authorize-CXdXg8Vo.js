import{e as N,a as q,b as M,A as P,u as B,c as R,r as d,j as e,f as $,B as n,S as V,g as X,M as G,d as H}from"./index-q3coxKpc.js";import{C as m}from"./index-C6EakQ48.js";import{T as J}from"./index-BnR03HeS.js";import{F as A,I as K}from"./index-BGxdU0Dl.js";import{D as I}from"./index-ClopC6KT.js";import"./TextArea-DBS6MHTP.js";const Q=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],W=N("arrow-right",Q);const Y=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Z=N("circle-check",Y);const ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],F=N("circle-x",ee),{Title:g,Text:c,Paragraph:se}=J;function ne(){const v=q(),[S]=M(),{message:r}=P.useApp(),{t:s}=B(),{ssoDetails:a,fetchSsoDetails:k,ssoConfirm:T,profile:b,token:C,logout:D,ssoSessionId:x,setSsoSessionId:i,ssoType:z,setSsoType:l,setSsoUserCode:u}=R(),h=S.get("session_id"),f=S.get("user_code"),y=h||x,[E,j]=d.useState(!1),[U,w]=d.useState(!1),[L,p]=d.useState(!1);d.useEffect(()=>{h&&(i&&h!==x&&i(h),l&&l("auth_code")),!C&&x&&v("/login",{replace:!0})},[h,x,i,l]),d.useEffect(()=>{f&&(l&&l("device_code"),u&&u(f))},[f,l,u]),d.useEffect(()=>{C&&(y||f)&&(p(!0),k().catch(t=>{console.error("Failed to fetch SSO details",t);const o=t;r.error(o.response?.data?.error||"Failed to fetch SSO details"),i&&i(null)}).finally(()=>{p(!1)}))},[]);const _=async t=>{if(!a||!y){r.error("Missing SSO session details");return}if(t?j(!0):w(!0),z==="auth_code"){try{const{data:o}=await H.post("/authorize/consent/redirect",{sessionId:y,approve:t});o?.data?.redirectUrl?window.location.href=o.data.redirectUrl:r.error("Invalid response from server")}catch{r.error("Failed to authorize request")}finally{j(!1),w(!1)}return}try{await T(t),t?r.success("Logged in to "+a?.appName):r.info("Login cancelled"),i&&i(null)}catch{r.error("Failed to confirm login")}finally{j(!1),w(!1)}},O=()=>{D(),v("/login",{replace:!0})};return!a&&L?e.jsx($,{}):a?a.status==="authorized"||a.status==="consumed"?e.jsx(m,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Z,{className:"text-green-500 mb-4 mx-auto",size:64}),e.jsx(g,{level:3,children:"Success!"}),e.jsxs(c,{className:"block mb-6",children:[s("auth.you-have-logged-in-to")," ",a.appName,".",e.jsx("br",{}),s("auth.you-can-close-this-window-now")]}),e.jsx(n,{type:"default",onClick:()=>window.close(),children:s("auth.close-window")})]})}):a.status==="denied"?e.jsx(m,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"mb-4 mx-auto",size:64}),e.jsx(g,{level:3,children:s("auth.canceled")}),e.jsxs(c,{className:"block mb-6",children:[s("auth.log-in-to")," ",a.appName," ",s("auth.was-cancelled"),e.jsx("br",{}),s("auth.you-can-close-this-window-now")]}),e.jsx(n,{type:"default",onClick:()=>window.close(),children:s("auth.close-window")})]})}):a.status==="pending"?e.jsx(m,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs(V,{orientation:"vertical",size:"large",className:"w-full text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(X,{size:64,url:{url:a.logoUrl,text:a.appName},className:"m-5"}),e.jsx(g,{level:3,className:"m-0",children:a.appName}),e.jsx(c,{type:"secondary",children:s("auth.wants-to-access-your-account")}),z==="device_code"&&e.jsx(c,{type:"warning",className:"mt-4",children:s("auth.make-sure-you-trust-the-device-you-are-connecting-to")})]}),e.jsx(I,{style:{margin:0}}),e.jsxs("div",{className:"text-left bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-4",children:[e.jsx(c,{type:"secondary",className:"text-xs uppercase font-bold tracking-wider",children:s("auth.signed-in-as")}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(G,{}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(c,{strong:!0,children:b?.nickname}),e.jsx(c,{type:"secondary",children:b?.username})]})]})]}),e.jsxs(n,{type:"primary",size:"large",block:!0,onClick:()=>_(!0),loading:E,children:[e.jsx(W,{}),s("auth.continue-to")," ",a.appName]}),e.jsxs("div",{children:[e.jsx(n,{type:"text",onClick:O,children:s("auth.change-account")}),e.jsx(I,{type:"vertical"}),e.jsx(n,{type:"text",onClick:()=>_(!1),loading:U,children:s("cancel")})]})]})}):e.jsx(m,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:" text-red-500 mb-4 mx-auto",size:64}),e.jsx(g,{level:3,children:"Error!"}),e.jsxs(c,{className:"block mb-6",children:[s("auth.there-was-an-error-logging-in-to")," ",a.appName,".",e.jsx("br",{}),s("auth.please-try-again")]}),e.jsx(n,{type:"default",onClick:()=>window.close(),children:s("auth.close-window")})]})}):e.jsxs(m,{className:"max-w-sm w-full shadow-2xl",title:s("auth.connect-a-device"),children:[e.jsx(se,{children:s("auth.enter-the-code-displayed-on-your-device")}),e.jsxs(A,{layout:"vertical",onFinish:t=>{u(t.code),l("device_code"),p(!0),k().catch(()=>{r.error("Failed to fetch SSO details with provided code"),u(null)}).finally(()=>{p(!1)})},children:[e.jsx(A.Item,{name:"code",label:s("auth.device-code"),rules:[{required:!0,message:s("auth.please-enter-the-code")}],children:e.jsx(K,{placeholder:"ABCD1234",size:"large",className:"text-center tracking-widest uppercase font-mono",maxLength:8,onChange:t=>{t.target.value=t.target.value.toUpperCase()}})}),e.jsx(n,{type:"primary",htmlType:"submit",block:!0,size:"large",children:s("continue")})]})]})}export{ne as default};
