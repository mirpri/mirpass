import{k as ie,g as ye,m as je,o as T,C as we,q as ve,t as ke,v as K,e as g,b as Ce,r as o,c as j,j as e,w as Ne,d as B,B as m,x as J,s as p,L as G,y as X}from"./index-BgHobQkF.js";import{F as Se,I as Pe}from"./FailedView-Cbrf4yx4.js";import{U as ze,R as Ie,f as Q,D as Me,F as $e,M as Z}from"./date-C1JcaJut.js";import{s as V}from"./crypto-Cw3CO9Ve.js";import{F as u,R as ee,C as O,I as C}from"./index-BoaVPCjC.js";import{C as se}from"./index-BELaRMtZ.js";import{i as ae,S as l,R as te}from"./TextArea-DDzZaqeS.js";import{T as Fe,R as H}from"./index-CpYTIEz2.js";import{D as ne}from"./index-CQoQ_nUP.js";import{K as be}from"./key-round-CwpI6hli.js";import"./index-CffZ0V7V.js";const ce=["wrap","nowrap","wrap-reverse"],oe=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],de=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"],Ee=(a,t)=>{const n=t.wrap===!0?"wrap":t.wrap;return{[`${a}-wrap-${n}`]:n&&ce.includes(n)}},Le=(a,t)=>{const n={};return de.forEach(r=>{n[`${a}-align-${r}`]=t.align===r}),n[`${a}-align-stretch`]=!t.align&&!!t.vertical,n},Ue=(a,t)=>{const n={};return oe.forEach(r=>{n[`${a}-justify-${r}`]=t.justify===r}),n},Ae=(a,t)=>ie({...Ee(a,t),...Le(a,t),...Ue(a,t)}),Re=a=>{const{componentCls:t}=a;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},_e=a=>{const{componentCls:t}=a;return{[t]:{"&-gap-small":{gap:a.flexGapSM},"&-gap-middle":{gap:a.flexGap},"&-gap-large":{gap:a.flexGapLG}}}},De=a=>{const{componentCls:t}=a,n={};return ce.forEach(r=>{n[`${t}-wrap-${r}`]={flexWrap:r}}),n},qe=a=>{const{componentCls:t}=a,n={};return de.forEach(r=>{n[`${t}-align-${r}`]={alignItems:r}}),n},Te=a=>{const{componentCls:t}=a,n={};return oe.forEach(r=>{n[`${t}-justify-${r}`]={justifyContent:r}}),n},Ge=()=>({}),Ve=ye("Flex",a=>{const{paddingXS:t,padding:n,paddingLG:r}=a,x=je(a,{flexGapSM:t,flexGap:n,flexGapLG:r});return[Re(x),_e(x),De(x),qe(x),Te(x)]},Ge,{resetStyle:!1}),W=T.forwardRef((a,t)=>{const{prefixCls:n,rootClassName:r,className:x,style:M,flex:f,gap:y,vertical:U,orientation:$,component:A="div",children:N,...R}=a,{flex:S,direction:_,getPrefixCls:F}=T.useContext(we),h=F("flex",n),[b,P]=Ve(h),[,z]=ve($,U??S?.vertical),w=ie(x,r,S?.className,h,b,P,Ae(h,a),{[`${h}-rtl`]:_==="rtl",[`${h}-gap-${y}`]:ae(y),[`${h}-vertical`]:z}),v={...S?.style,...M};return K(f)&&(v.flex=f),K(y)&&!ae(y)&&(v.gap=y),T.createElement(A,{ref:t,className:w,style:v,...ke(R,["justify","wrap","align"])},N)});const Oe=[["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}],["path",{d:"M10 4v4",key:"pp8u80"}],["path",{d:"M2 8h20",key:"d11cs7"}],["path",{d:"M6 4v4",key:"1svtjw"}]],re=g("app-window",Oe);const He=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],We=g("circle-user",He);const Ye=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ke=g("clock",Ye);const Be=[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]],Je=g("id-card",Be);const Xe=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],le=g("mail",Xe);const Qe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ze=g("plus",Qe);const es=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M8 12h.01",key:"czm47f"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M16 12h.01",key:"1l6xoz"}]],ss=g("shield-ellipsis",es);const as=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ts=g("tag",as),{Title:ns,Text:c}=Fe;function gs(){const{profile:a,myApps:t,fetchMyApps:n,updateProfile:r,isLoadingProfile:x}=Ce(),[M,f]=o.useState(null),[y,U]=o.useState([]),[$,A]=o.useState([]),[N,R]=o.useState(null);o.useEffect(()=>{n(),S()},[]),o.useEffect(()=>{_(N)},[N]);const S=async()=>{try{const{data:s}=await j.get("/user/apps/summary");A(s.data||[])}catch{}},_=async s=>{try{let i="/user/history";if(s){const I=s.format("YYYY-MM-DD"),fe=s.utcOffset();i+=`?date=${I}&offset=${fe}`}const{data:d}=await j.get(i);U(d.data||[])}catch{}},[F,h]=o.useState({avatar:!1,nickname:!1}),[b,P]=o.useState(""),[z,w]=o.useState(""),[v,Y]=o.useState(null);o.useEffect(()=>{n()},[]),o.useEffect(()=>{a&&(P(a.nickname||""),w(a.avatarUrl||""))},[a]);const k=(s,i)=>{h(d=>({...d,[s]:i})),s==="nickname"&&P(a?.nickname||""),s==="avatar"&&w(a?.avatarUrl||"")},me=async()=>{const s=b.trim();if(!s){p.warning("nickname cannot be empty");return}f("nickname");try{const{data:i}=await j.post("/profile/nickname",{nickname:s});r({nickname:s}),p.success(i?.message||"nickname updated"),k("nickname",!1)}catch(i){const d=i;p.error(d.response?.data?.message||"Could not update nickname")}finally{f(null)}},pe=async()=>{f("avatar");try{let s;if(v){const d=new FormData;d.append("file",v);const{data:I}=await j.post("/profile/avatar",d,{headers:{"Content-Type":"multipart/form-data"}});s=I}else{const d=z.trim(),{data:I}=await j.post("/profile/avatar",{avatarUrl:d});s=I}let i=s.data?.avatarUrl||z;i.startsWith("/blob/")&&X.API_URL&&(i=X.API_URL.replace(/\/$/,"")+i),r({avatarUrl:i}),p.success(s?.message||"Avatar updated"),k("avatar",!1),Y(null)}catch(s){const i=s;p.error(i.response?.data?.message||"Could not update avatar")}finally{f(null)}},[xe,D]=o.useState(!1),[E]=u.useForm(),[he,q]=o.useState(!1),[L]=u.useForm(),ue=async()=>{try{const s=await E.validateFields();await j.post("/profile/password",{currentPassword:await V(s.currentPassword),newPassword:await V(s.newPassword)}),p.success("Password updated successfully"),D(!1),E.resetFields()}catch(s){p.error(s.response?.data?.message||"Failed to update password")}},ge=async()=>{try{const s=await L.validateFields();await j.post("/profile/email/change",{password:await V(s.password),newEmail:s.newEmail}),p.success("Verification email sent to new address"),q(!1),L.resetFields()}catch(s){p.error(s.response?.data?.message||"Failed to request email change")}};return x?e.jsx(Ne,{}):a?e.jsxs(se,{className:"max-w-4xl w-full shadow-xl",children:[e.jsx(W,{justify:"space-between",align:"center",wrap:!0,children:e.jsxs(l,{orientation:"vertical",size:4,children:[e.jsx(ns,{level:3,className:"m-0",children:"Dashboard"}),e.jsx(c,{type:"secondary",children:"Manage your profile and credentials"})]})}),e.jsx(ne,{className:"my-6"}),e.jsxs(ee,{gutter:[24,24],align:"stretch",children:[e.jsx(O,{xs:24,sm:9,children:e.jsxs(l,{orientation:"vertical",size:16,className:"w-full p-4",children:[e.jsx(B,{size:96,src:a?.avatarUrl,className:"shadow-lg",children:a?.username?.charAt(0).toUpperCase()}),e.jsx(c,{strong:!0,className:"text-xl",children:a?.nickname||a?.username||"—"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(l,{align:"center",size:10,children:[e.jsx(Je,{color:"#3aaeed",size:16}),e.jsx(c,{children:a?.username||"—"})]}),e.jsxs(l,{align:"center",size:10,children:[e.jsx(le,{color:"#3aaeed",size:16}),e.jsx(c,{children:a?.email||"—"})]})]})]})}),e.jsx(O,{xs:24,sm:15,children:e.jsxs(l,{orientation:"vertical",size:32,className:"w-full p-4",children:[e.jsxs("div",{children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(ts,{color:"#3aaeed",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Nickname"})]}),e.jsx("div",{className:"mt-[14px]",children:F.nickname?e.jsxs(l.Compact,{children:[e.jsx(C,{value:b,onChange:s=>P(s.target.value),placeholder:"Set a nickname",className:"min-w-[190px]"}),e.jsx(m,{type:"primary",icon:e.jsx(te,{}),loading:M==="nickname",onClick:me}),e.jsx(m,{icon:e.jsx(J,{}),type:"default",onClick:()=>k("nickname",!1)})]}):e.jsxs(l,{align:"center",children:[e.jsx(c,{type:"secondary",children:a?.nickname||"No nickname set"}),e.jsx(m,{type:"link",icon:e.jsx(H,{}),onClick:()=>k("nickname",!0),children:"Update"})]})})]}),e.jsxs("div",{children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(We,{color:"#3aaeed",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Avatar"})]}),e.jsx("div",{className:"mt-[14px]",children:F.avatar?e.jsxs(l,{children:[e.jsxs(l.Compact,{children:[e.jsx(C,{value:z,onChange:s=>w(s.target.value),placeholder:"https://example.com/avatar.jpg",className:"min-w-[220px]"}),e.jsx(m,{type:"primary",icon:e.jsx(te,{}),loading:M==="avatar",onClick:pe}),e.jsx(m,{icon:e.jsx(J,{}),type:"default",onClick:()=>k("avatar",!1)})]}),e.jsx(Pe,{rotationSlider:!0,children:e.jsx(ze,{showUploadList:!1,customRequest:({file:s,onSuccess:i})=>{const d=s;Y(d),w(URL.createObjectURL(d)),p.info("Image selected. Click check to save."),i?.("ok")},children:e.jsx(m,{icon:e.jsx(Ie,{}),children:"Select"})})})]}):e.jsxs(l,{wrap:!0,align:"center",children:[e.jsx(c,{type:"secondary",children:a?.avatarUrl?"Custom URL linked":"No avatar set"}),e.jsx(m,{type:"link",icon:e.jsx(H,{}),onClick:()=>k("avatar",!0),children:"Update"})]})})]}),e.jsxs("div",{children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(le,{color:"#3aaeed",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Email"})]}),e.jsxs("div",{className:"mt-[14px]",children:[e.jsx(c,{type:"secondary",className:"mr-4",children:a?.email||"No Email"}),e.jsx(m,{type:"link",icon:e.jsx(H,{}),onClick:()=>q(!0),className:"pl-0",children:"Change Email"})]})]}),e.jsxs("div",{children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(be,{color:"#3aaeed",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Password"})]}),e.jsxs("div",{className:"mt-[14px]",children:[e.jsx(m,{type:"link",onClick:()=>D(!0),className:"pl-0",children:"Change Password"}),e.jsx(G,{to:"/forget",className:"ml-4",children:"Forgot Password"})]})]}),e.jsxs("div",{children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(re,{color:"#3aaeed",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"My Applications"})]}),e.jsxs("div",{className:"mt-[14px] flex flex-wrap gap-2",children:[t.map(s=>e.jsx(G,{to:s.name==="system"?"/manage":`/manage/${s.appId}`,children:e.jsxs(m,{children:[e.jsx(ss,{size:14}),s.name]})},s.appId)),e.jsx(G,{to:"/apps/create",children:e.jsxs(m,{type:"dashed",children:[e.jsx(Ze,{size:14}),"Create New App"]})})]})]})]})})]}),e.jsx(ne,{className:"my-6"}),e.jsxs(l,{orientation:"vertical",style:{width:"100%"},className:"mb-8",children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(re,{color:"#3aaeed",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Applications Logged Into"})]}),e.jsxs(ee,{gutter:[16,16],className:"mt-4",children:[$.map(s=>e.jsx(O,{xs:24,sm:12,md:8,lg:6,children:e.jsx(se,{size:"small",className:"hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(W,{align:"center",gap:10,children:[e.jsx(B,{src:s.logoUrl,children:s.app.charAt(0).toUpperCase()}),e.jsx(c,{strong:!0,children:s.app})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Last Login: ",e.jsx("br",{}),Q(s.time)]})]})})},s.app)),$.length===0&&e.jsx(c,{type:"secondary",className:"pl-4",children:"No login history found."})]})]}),e.jsxs(l,{orientation:"vertical",style:{width:"100%"},children:[e.jsxs(W,{justify:"space-between",align:"center",children:[e.jsxs(l,{align:"center",size:12,children:[e.jsx(Ke,{size:16,color:"#3aaeed"}),e.jsx(c,{strong:!0,className:"text-base",children:"Login History"})]}),e.jsx(Me,{value:N,onChange:R,placeholder:"Select Date",allowClear:!0})]}),e.jsx($e,{dataSource:y,rowKey:s=>s.time+s.app+Math.random(),pagination:{pageSize:5},size:"small",locale:{emptyText:"No history found"},columns:[{title:"Application",dataIndex:"app",key:"appName"},{title:"Time",dataIndex:"time",key:"time",render:s=>Q(s)}]})]}),e.jsx(Z,{title:"Change Password",open:xe,onOk:ue,onCancel:()=>{D(!1),E.resetFields()},children:e.jsxs(u,{form:E,layout:"vertical",children:[e.jsx(u.Item,{name:"currentPassword",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:e.jsx(C.Password,{})}),e.jsx(u.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please enter a new password"},{min:8,message:"Password must be at least 8 characters"}],children:e.jsx(C.Password,{})})]})}),e.jsx(Z,{title:"Change Email",open:he,onOk:ge,onCancel:()=>{q(!1),L.resetFields()},children:e.jsxs(u,{form:L,layout:"vertical",children:[e.jsx(u.Item,{name:"newEmail",label:"New Email",rules:[{required:!0,message:"Please enter your new email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(C,{})}),e.jsx(u.Item,{name:"password",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:e.jsx(C.Password,{})})]})})]}):e.jsx(Se,{})}export{gs as default};
