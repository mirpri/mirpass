import{n as ce,h as je,m as we,v as q,y as ve,E as ke,F as Ne,G as J,H as B,e as f,c as Ce,u as Se,A as ze,r as d,d as v,j as e,f as $e,S as c,M as Ie,B as x,J as X,L as G,g as Q,K as Z}from"./index-C2B0u0zW.js";import{F as Fe,I as Me}from"./FailedView-mriDKCza.js";import{U as be,R as Pe,f as ee,D as Ee,F as Ae,M as se}from"./date-D00xX3sB.js";import{s as V}from"./crypto-B9Mf35RN.js";import{F as g,R as ae,C as O,I as C}from"./index-UTYdrC8N.js";import{C as te}from"./index-SSNrkNt9.js";import{T as Re,R as H}from"./index-LUkknupk.js";import{D as re}from"./index-D-VGSTdc.js";import{R as ne}from"./TextArea-LJwfqUvu.js";import{K as _e}from"./key-round-xgvWOhDd.js";import"./index-DT0R6jNm.js";const oe=["wrap","nowrap","wrap-reverse"],de=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],me=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"],Le=(a,r)=>{const n=r.wrap===!0?"wrap":r.wrap;return{[`${a}-wrap-${n}`]:n&&oe.includes(n)}},Ue=(a,r)=>{const n={};return me.forEach(i=>{n[`${a}-align-${i}`]=r.align===i}),n[`${a}-align-stretch`]=!r.align&&!!r.vertical,n},De=(a,r)=>{const n={};return de.forEach(i=>{n[`${a}-justify-${i}`]=r.justify===i}),n},Te=(a,r)=>ce({...Le(a,r),...Ue(a,r),...De(a,r)}),qe=a=>{const{componentCls:r}=a;return{[r]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},Ge=a=>{const{componentCls:r}=a;return{[r]:{"&-gap-small":{gap:a.flexGapSM},"&-gap-middle":{gap:a.flexGap},"&-gap-large":{gap:a.flexGapLG}}}},Ve=a=>{const{componentCls:r}=a,n={};return oe.forEach(i=>{n[`${r}-wrap-${i}`]={flexWrap:i}}),n},Oe=a=>{const{componentCls:r}=a,n={};return me.forEach(i=>{n[`${r}-align-${i}`]={alignItems:i}}),n},He=a=>{const{componentCls:r}=a,n={};return de.forEach(i=>{n[`${r}-justify-${i}`]={justifyContent:i}}),n},We=()=>({}),Ke=je("Flex",a=>{const{paddingXS:r,padding:n,paddingLG:i}=a,h=we(a,{flexGapSM:r,flexGap:n,flexGapLG:i});return[qe(h),Ge(h),Ve(h),Oe(h),He(h)]},We,{resetStyle:!1}),W=q.forwardRef((a,r)=>{const{prefixCls:n,rootClassName:i,className:h,style:t,flex:m,gap:u,vertical:k,orientation:E,component:A="div",children:$,...R}=a,{flex:j,direction:_,getPrefixCls:L}=q.useContext(ve),y=L("flex",n),[I,U]=Ke(y),[,F]=ke(E,k??j?.vertical),S=ce(h,i,j?.className,y,I,U,Te(y,a),{[`${y}-rtl`]:_==="rtl",[`${y}-gap-${u}`]:J(u),[`${y}-vertical`]:F}),w={...j?.style,...t};return B(m)&&(w.flex=m),B(u)&&!J(u)&&(w.gap=u),q.createElement(A,{ref:r,className:S,style:w,...Ne(R,["justify","wrap","align"])},$)});const Ye=[["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}],["path",{d:"M10 4v4",key:"pp8u80"}],["path",{d:"M2 8h20",key:"d11cs7"}],["path",{d:"M6 4v4",key:"1svtjw"}]],le=f("app-window",Ye);const Je=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],Be=f("circle-user",Je);const Xe=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Qe=f("clock",Xe);const Ze=[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]],es=f("id-card",Ze);const ss=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],ie=f("mail",ss);const as=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ts=f("plus",as);const rs=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],ns=f("shield",rs);const ls=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],is=f("tag",ls),{Title:cs,Text:o}=Re;function ws(){const{profile:a,myApps:r,fetchMyApps:n,updateProfile:i,isLoadingProfile:h}=Ce(),{t}=Se(),{message:m}=ze.useApp(),[u,k]=d.useState(null),[E,A]=d.useState([]),[$,R]=d.useState([]),[j,_]=d.useState(null);d.useEffect(()=>{n(),L()},[]),d.useEffect(()=>{y(j)},[j]);const L=async()=>{try{const{data:s}=await v.get("/user/apps/summary");R(s.data||[])}catch{}},y=async s=>{try{let l="/user/history";if(s){const z=s.format("YYYY-MM-DD"),fe=s.utcOffset();l+=`?date=${z}&offset=${fe}`}const{data:p}=await v.get(l);A(p.data||[])}catch{}},[I,U]=d.useState({avatar:!1,nickname:!1}),[F,S]=d.useState(""),[w,M]=d.useState(""),[K,Y]=d.useState(null);d.useEffect(()=>{n()},[]),d.useEffect(()=>{a&&(S(a.nickname||""),M(a.avatarUrl||""))},[a]);const N=(s,l)=>{U(p=>({...p,[s]:l})),s==="nickname"&&S(a?.nickname||""),s==="avatar"&&M(a?.avatarUrl||"")},pe=async()=>{const s=F.trim();if(!s){m.warning("nickname cannot be empty");return}k("nickname");try{const{data:l}=await v.post("/profile/nickname",{nickname:s});i({nickname:s}),m.success(l?.message||"nickname updated"),N("nickname",!1)}catch(l){const p=l;m.error(p.response?.data?.error||"Could not update nickname")}finally{k(null)}},xe=async()=>{k("avatar");try{let s;if(K){const p=new FormData;p.append("file",K);const{data:z}=await v.post("/profile/avatar",p,{headers:{"Content-Type":"multipart/form-data"}});s=z}else{const p=w.trim(),{data:z}=await v.post("/profile/avatar",{avatarUrl:p});s=z}let l=s.data?.avatarUrl||w;l.startsWith("/blob/")&&Z.API_URL&&(l=Z.API_URL.replace(/\/$/,"")+l),i({avatarUrl:l}),m.success(s?.message||"Avatar updated"),N("avatar",!1),Y(null)}catch(s){const l=s;m.error(l.response?.data?.error||"Could not update avatar")}finally{k(null)}},[he,D]=d.useState(!1),[b]=g.useForm(),[ue,T]=d.useState(!1),[P]=g.useForm(),ye=async()=>{try{const s=await b.validateFields();await v.post("/profile/password",{currentPassword:await V(s.currentPassword),newPassword:await V(s.newPassword)}),m.success("Password updated successfully"),D(!1),b.resetFields()}catch(s){const l=s;m.error(l.response?.data?.error||"Failed to update password")}},ge=async()=>{try{const s=await P.validateFields();await v.post("/profile/email/change",{password:await V(s.password),newEmail:s.newEmail}),m.success("Verification email sent to new address"),T(!1),P.resetFields()}catch(s){const l=s;m.error(l.response?.data?.error||"Failed to request email change")}};return h?e.jsx($e,{}):a?e.jsxs(te,{className:"max-w-4xl w-full shadow-xl",children:[e.jsx(W,{justify:"space-between",align:"center",wrap:!0,children:e.jsxs(c,{orientation:"vertical",size:4,children:[e.jsx(cs,{level:3,className:"m-0",children:t("dash.dashboard")}),e.jsx(o,{type:"secondary",children:t("dash.manage-your-profile-and-credentials")})]})}),e.jsx(re,{className:"my-6"}),e.jsxs(ae,{gutter:[24,24],align:"stretch",children:[e.jsx(O,{xs:24,sm:9,children:e.jsxs(c,{orientation:"vertical",size:16,className:"w-full p-4",children:[e.jsx(Ie,{size:96}),e.jsx(o,{strong:!0,className:"text-xl",children:a?.nickname||a?.username||"—"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(c,{align:"center",size:10,children:[e.jsx(es,{className:"text-primary-500",size:16}),e.jsx(o,{children:a?.username||"—"})]}),e.jsxs(c,{align:"center",size:10,children:[e.jsx(ie,{className:"text-primary-500",size:16}),e.jsx(o,{children:a?.email||"—"})]})]})]})}),e.jsx(O,{xs:24,sm:15,children:e.jsxs(c,{orientation:"vertical",size:32,className:"w-full p-4",children:[e.jsxs("div",{children:[e.jsxs(c,{align:"center",size:12,children:[e.jsx(is,{className:"text-primary-500",size:16}),e.jsx(o,{strong:!0,className:"text-base",children:t("dash.nickname")})]}),e.jsx("div",{className:"mt-[14px]",children:I.nickname?e.jsxs(c.Compact,{children:[e.jsx(C,{value:F,onChange:s=>S(s.target.value),placeholder:t("dash.set-a-nickname"),className:"min-w-[190px]"}),e.jsx(x,{type:"primary",icon:e.jsx(ne,{}),loading:u==="nickname",onClick:pe}),e.jsx(x,{icon:e.jsx(X,{}),type:"default",onClick:()=>N("nickname",!1)})]}):e.jsxs(c,{align:"center",children:[e.jsx(o,{type:"secondary",children:a?.nickname||t("dash.no-nickname-set")}),e.jsx(x,{type:"link",icon:e.jsx(H,{}),onClick:()=>N("nickname",!0),children:t("dash.update")})]})})]}),e.jsxs("div",{children:[e.jsxs(c,{align:"center",size:12,children:[e.jsx(Be,{className:"text-primary-500",size:16}),e.jsx(o,{strong:!0,className:"text-base",children:t("dash.avatar")})]}),e.jsx("div",{className:"mt-[14px]",children:I.avatar?e.jsxs(c,{children:[e.jsxs(c.Compact,{children:[e.jsx(C,{value:w,onChange:s=>M(s.target.value),placeholder:"https://example.com/avatar.jpg",className:"min-w-[220px]"}),e.jsx(x,{type:"primary",icon:e.jsx(ne,{}),loading:u==="avatar",onClick:xe}),e.jsx(x,{icon:e.jsx(X,{}),type:"default",onClick:()=>N("avatar",!1)})]}),e.jsx(Me,{rotationSlider:!0,children:e.jsx(be,{showUploadList:!1,customRequest:({file:s,onSuccess:l})=>{const p=s;Y(p),M(URL.createObjectURL(p)),m.info(t("dash.image-selected-click-check-to-save")),l?.("ok")},children:e.jsx(x,{icon:e.jsx(Pe,{}),children:t("dash.select")})})})]}):e.jsxs(c,{wrap:!0,align:"center",children:[e.jsx(o,{type:"secondary",children:a?.avatarUrl?t("dash.custom-url-linked"):t("dash.no-avatar-set")}),e.jsx(x,{type:"link",icon:e.jsx(H,{}),onClick:()=>N("avatar",!0),children:t("dash.update")})]})})]}),e.jsxs("div",{children:[e.jsxs(c,{align:"center",size:12,children:[e.jsx(ie,{className:"text-primary-500",size:16}),e.jsx(o,{strong:!0,className:"text-base",children:t("email")})]}),e.jsxs("div",{className:"mt-[14px]",children:[e.jsx(o,{type:"secondary",className:"mr-4",children:a?.email||t("dash.no-email")}),e.jsx(x,{type:"link",icon:e.jsx(H,{}),onClick:()=>T(!0),className:"pl-0",children:t("dash.change-email")})]})]}),e.jsxs("div",{children:[e.jsxs(c,{align:"center",size:12,children:[e.jsx(_e,{className:"text-primary-500",size:16}),e.jsx(o,{strong:!0,className:"text-base",children:t("password")})]}),e.jsxs("div",{className:"mt-[14px]",children:[e.jsx(x,{type:"link",onClick:()=>D(!0),className:"pl-0",children:t("dash.change-password")}),e.jsx(G,{to:"/forget",className:"ml-4",children:t("dash.forgot-password")})]})]}),e.jsxs("div",{children:[e.jsxs(c,{align:"center",size:12,children:[e.jsx(le,{className:"text-primary-500",size:16}),e.jsx(o,{strong:!0,className:"text-base",children:t("dash.my-applications")})]}),e.jsxs("div",{className:"mt-[14px] flex flex-wrap gap-2",children:[r.map(s=>e.jsx(G,{to:s.name==="system"?"/manage":`/manage/${s.appId}`,children:e.jsxs(x,{children:[s.name==="system"?e.jsx(ns,{size:14}):e.jsx(Q,{size:20,url:{url:s.logoUrl,text:s.name}})," ",s.name]})},s.appId)),e.jsx(G,{to:"/apps/create",children:e.jsxs(x,{type:"dashed",children:[e.jsx(ts,{size:14}),t("dash.create-new-app")]})})]})]})]})})]}),e.jsx(re,{className:"my-6"}),e.jsxs(c,{orientation:"vertical",style:{width:"100%"},className:"mb-8",children:[e.jsxs(c,{align:"center",size:12,children:[e.jsx(le,{className:"text-primary-500",size:16}),e.jsx(o,{strong:!0,className:"text-base",children:t("dash.applications-logged-into")})]}),e.jsxs(ae,{gutter:[16,16],className:"mt-4",children:[$.map(s=>e.jsx(O,{xs:24,sm:12,md:8,lg:6,children:e.jsx(te,{size:"small",className:"hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(W,{align:"center",gap:10,children:[e.jsx(Q,{url:{url:s.logoUrl,text:s.app},size:"small"}),e.jsx(o,{strong:!0,children:s.app})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t("dash.last-login")," ",e.jsx("br",{}),ee(s.time)]})]})})},s.app)),$.length===0&&e.jsx(o,{type:"secondary",className:"pl-4",children:t("dash.no-login-history-found")})]})]}),e.jsxs(c,{orientation:"vertical",style:{width:"100%"},children:[e.jsxs(W,{justify:"space-between",align:"center",children:[e.jsxs(c,{align:"center",size:12,children:[e.jsx(Qe,{className:"text-primary-500",size:16}),e.jsx(o,{strong:!0,className:"text-base",children:t("dash.login-history")})]}),e.jsx(Ee,{value:j,onChange:_,placeholder:t("dash.select-date"),allowClear:!0})]}),e.jsx(Ae,{dataSource:E,rowKey:s=>s.time+s.app+Math.random(),pagination:{pageSize:5},size:"small",locale:{emptyText:t("dash.no-history-found")},columns:[{title:t("application"),dataIndex:"app",key:"appName"},{title:t("time"),dataIndex:"time",key:"time",render:s=>ee(s)}]})]}),e.jsx(se,{title:t("dash.change-password"),open:he,onOk:ye,onCancel:()=>{D(!1),b.resetFields()},children:e.jsxs(g,{form:b,layout:"vertical",children:[e.jsx(g.Item,{name:"currentPassword",label:t("dash.current-password"),rules:[{required:!0,message:t("dash.please-enter-your-current-password")}],children:e.jsx(C.Password,{})}),e.jsx(g.Item,{name:"newPassword",label:t("dash.new-password"),rules:[{required:!0,message:t("dash.please-enter-a-new-password")},{min:8,message:t("reg.password-must-be-at-least-8-characters")}],children:e.jsx(C.Password,{})})]})}),e.jsx(se,{title:t("dash.change-email"),open:ue,onOk:ge,onCancel:()=>{T(!1),P.resetFields()},children:e.jsxs(g,{form:P,layout:"vertical",children:[e.jsx(g.Item,{name:"newEmail",label:t("dash.new-email"),rules:[{required:!0,message:t("dash.please-enter-your-new-email")},{type:"email",message:t("reg.please-enter-a-valid-email")}],children:e.jsx(C,{})}),e.jsx(g.Item,{name:"password",label:t("dash.current-password"),rules:[{required:!0,message:t("dash.please-enter-your-current-password")}],children:e.jsx(C.Password,{})})]})})]}):e.jsx(Fe,{})}export{ws as default};
