import{d as C,u as E,a as L,A as U,b as q,r as m,j as e,e as O,B as l,f as M,M as R,g as B}from"./index-DZEDcsWI.js";import{C as h}from"./index-DIkFV8Xl.js";import{T as W}from"./index-2mmJRiEo.js";import{F as _,I as Y}from"./index-BMSKr2De.js";import{S as V}from"./TextArea-ilqXQoyS.js";import{D as A}from"./index-B8DAGkob.js";const X=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],G=C("arrow-right",X);const H=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],J=C("circle-check",H);const K=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],I=C("circle-x",K),{Title:p,Text:n,Paragraph:Q}=W;function oe(){const v=E(),[g]=L(),{message:d}=U.useApp(),{ssoDetails:s,fetchSsoDetails:S,ssoConfirm:$,profile:k,token:y,logout:D,ssoSessionId:j,setSsoSessionId:r,ssoType:F,setSsoType:o,setSsoUserCode:u}=q(),x=g.get("session_id"),w=g.get("from"),t=g.get("user_code"),c=x||j,[b,N]=m.useState(!1),[P,f]=m.useState(!1);m.useEffect(()=>{x&&(r&&x!==j&&r(x),o&&o("auth_code"))},[x,j,r,o]),m.useEffect(()=>{t&&(o&&o("device_code"),u&&u(t))},[t,o,u]),m.useEffect(()=>{if(!y&&(c||t)){const a=w?`&from=${encodeURIComponent(w)}`:"",i=[];c&&i.push(`session_id=${c}`),t&&i.push(`user_code=${t}`);const T=i.length>0?`?${i.join("&")}${a}`:"";v(`/login${T}`,{replace:!0})}},[y,c,t,w,v,s]),m.useEffect(()=>{y&&(c||t)&&(f(!0),S().catch(a=>{console.error("Failed to fetch SSO details",a);const i=a;d.error(i.response?.data?.error||"Failed to fetch SSO details"),r&&r(null)}).finally(()=>{f(!1)}))},[]);const z=async a=>{if(!s||!c){d.error("Missing SSO session details");return}if(N(!0),F==="auth_code"){window.location.href=`${B.API_URL}/authorize/consent/redirect?sessionId=${c}&approve=${a}`,N(!1);return}try{await $(a),a?d.success(`Logged in to ${s?.appName}`):d.info("Login cancelled"),r&&r(null)}catch{d.error("Failed to confirm login")}finally{N(!1)}};return!s&&P?e.jsx(O,{}):s?s.status==="authorized"||s.status==="consumed"?e.jsx(h,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"text-green-500 mb-4 mx-auto",size:64}),e.jsx(p,{level:3,children:"Success!"}),e.jsxs(n,{className:"block mb-6",children:["You have logged in to ",s.appName,".",e.jsx("br",{}),"You can close this window now."]}),e.jsx(l,{type:"default",onClick:()=>window.close(),children:"Close Window"})]})}):s.status==="denied"?e.jsx(h,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"mb-4 mx-auto",size:64}),e.jsx(p,{level:3,children:"Canceled"}),e.jsxs(n,{className:"block mb-6",children:["Log in to ",s.appName," was cancelled.",e.jsx("br",{}),"You can close this window now."]}),e.jsx(l,{type:"default",onClick:()=>window.close(),children:"Close Window"})]})}):s.status==="pending"?e.jsx(h,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs(V,{orientation:"vertical",size:"large",className:"w-full text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(M,{size:64,url:{url:s.logoUrl,text:s.appName},className:"m-5"}),e.jsx(p,{level:3,className:"m-0",children:s.appName}),e.jsx(n,{type:"secondary",children:"wants to access your account"})]}),e.jsx(A,{className:"my-2"}),e.jsxs("div",{className:"text-left bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-4",children:[e.jsx(n,{type:"secondary",className:"text-xs uppercase font-bold tracking-wider",children:"Signed in as"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(R,{}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(n,{strong:!0,children:k?.nickname}),e.jsx(n,{type:"secondary",children:k?.username})]})]})]}),e.jsxs(l,{type:"primary",size:"large",block:!0,onClick:()=>z(!0),loading:b,children:[e.jsx(G,{}),"Continue to ",s.appName]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{type:"text",onClick:D,children:"Change Account"}),e.jsx(A,{type:"vertical"}),e.jsx(l,{type:"text",danger:!0,onClick:()=>z(!1),loading:b,children:"Cancel"})]})]})}):e.jsx(h,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:" text-red-500 mb-4 mx-auto",size:64}),e.jsx(p,{level:3,children:"Error!"}),e.jsxs(n,{className:"block mb-6",children:["There was an error logging in to ",s.appName,".",e.jsx("br",{}),"Please try again or contact support."]}),e.jsx(l,{type:"default",onClick:()=>window.close(),children:"Close Window"})]})}):e.jsxs(h,{className:"max-w-sm w-full shadow-2xl",title:"Connect a Device",children:[e.jsx(Q,{children:"Enter the code displayed on your device."}),e.jsxs(_,{layout:"vertical",onFinish:a=>{u(a.code),o("device_code"),f(!0),S().catch(()=>{d.error("Failed to fetch SSO details with provided code"),u(null)}).finally(()=>{f(!1)})},children:[e.jsx(_.Item,{name:"code",label:"Device Code",rules:[{required:!0,message:"Please enter the code"}],children:e.jsx(Y,{placeholder:"ABCD1234",size:"large",className:"text-center tracking-widest uppercase font-mono",maxLength:8,onChange:a=>{a.target.value=a.target.value.toUpperCase()}})}),e.jsx(l,{type:"primary",htmlType:"submit",block:!0,size:"large",children:"Continue"})]})]})}export{oe as default};
