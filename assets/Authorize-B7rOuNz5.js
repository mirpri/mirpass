import{d as v,u as P,a as U,A as q,b as L,r as m,j as e,e as M,B as d,f as O,M as B,c as R}from"./index-C1qiHovD.js";import{C as x}from"./index-Cd4gSAcP.js";import{T as W}from"./index-DsEsYiwj.js";import{F as I,I as Y}from"./index-BpHuEX1Q.js";import{S as V}from"./TextArea-TCOLGvF0.js";import{D as A}from"./index-u3CBKLRX.js";const X=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],G=v("arrow-right",X);const H=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],J=v("circle-check",H);const K=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],F=v("circle-x",K),{Title:p,Text:i,Paragraph:Q}=W;function oe(){const C=P(),[g]=U(),{message:r}=q.useApp(),{ssoDetails:s,fetchSsoDetails:S,ssoConfirm:D,profile:k,token:y,logout:T,ssoSessionId:j,setSsoSessionId:c,ssoType:b,setSsoType:l,setSsoUserCode:u}=L(),h=g.get("session_id"),w=g.get("from"),o=g.get("user_code"),n=h||j,[z,N]=m.useState(!1),[$,f]=m.useState(!1);m.useEffect(()=>{h&&(c&&h!==j&&c(h),l&&l("auth_code"))},[h,j,c,l]),m.useEffect(()=>{o&&(l&&l("device_code"),u&&u(o))},[o,l,u]),m.useEffect(()=>{if(!y&&(n||o)){const a=w?`&from=${encodeURIComponent(w)}`:"",t=[];n&&t.push(`session_id=${n}`),o&&t.push(`user_code=${o}`);const E=t.length>0?`?${t.join("&")}${a}`:"";C(`/login${E}`,{replace:!0})}},[y,n,o,w,C,s]),m.useEffect(()=>{y&&(n||o)&&(f(!0),S().catch(a=>{console.error("Failed to fetch SSO details",a);const t=a;r.error(t.response?.data?.error||"Failed to fetch SSO details"),c&&c(null)}).finally(()=>{f(!1)}))},[]);const _=async a=>{if(!s||!n){r.error("Missing SSO session details");return}if(N(!0),b==="auth_code"){try{const{data:t}=await R.post("/authorize/consent/redirect",{sessionId:n,approve:a});t?.data?.redirectUrl?window.location.href=t.data.redirectUrl:r.error("Invalid response from server")}catch{r.error("Failed to authorize request")}finally{N(!1)}return}try{await D(a),a?r.success(`Logged in to ${s?.appName}`):r.info("Login cancelled"),c&&c(null)}catch{r.error("Failed to confirm login")}finally{N(!1)}};return!s&&$?e.jsx(M,{}):s?s.status==="authorized"||s.status==="consumed"?e.jsx(x,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"text-green-500 mb-4 mx-auto",size:64}),e.jsx(p,{level:3,children:"Success!"}),e.jsxs(i,{className:"block mb-6",children:["You have logged in to ",s.appName,".",e.jsx("br",{}),"You can close this window now."]}),e.jsx(d,{type:"default",onClick:()=>window.close(),children:"Close Window"})]})}):s.status==="denied"?e.jsx(x,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"mb-4 mx-auto",size:64}),e.jsx(p,{level:3,children:"Canceled"}),e.jsxs(i,{className:"block mb-6",children:["Log in to ",s.appName," was cancelled.",e.jsx("br",{}),"You can close this window now."]}),e.jsx(d,{type:"default",onClick:()=>window.close(),children:"Close Window"})]})}):s.status==="pending"?e.jsx(x,{className:"max-w-md w-full shadow-2xl",children:e.jsxs(V,{orientation:"vertical",size:"large",className:"w-full text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(O,{size:64,url:{url:s.logoUrl,text:s.appName},className:"m-5"}),e.jsx(p,{level:3,className:"m-0",children:s.appName}),e.jsx(i,{type:"secondary",children:"wants to access your account"}),b==="device_code"&&e.jsx(i,{type:"warning",className:"mt-4",children:"Make sure you trust the device you are connecting to."})]}),e.jsx(A,{style:{margin:0}}),e.jsxs("div",{className:"text-left bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-4",children:[e.jsx(i,{type:"secondary",className:"text-xs uppercase font-bold tracking-wider",children:"Signed in as"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(B,{}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(i,{strong:!0,children:k?.nickname}),e.jsx(i,{type:"secondary",children:k?.username})]})]})]}),e.jsxs(d,{type:"primary",size:"large",block:!0,onClick:()=>_(!0),loading:z,children:[e.jsx(G,{}),"Continue to ",s.appName]}),e.jsxs("div",{children:[e.jsx(d,{type:"text",onClick:T,children:"Change Account"}),e.jsx(A,{type:"vertical"}),e.jsx(d,{type:"text",onClick:()=>_(!1),loading:z,children:"Cancel"})]})]})}):e.jsx(x,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:" text-red-500 mb-4 mx-auto",size:64}),e.jsx(p,{level:3,children:"Error!"}),e.jsxs(i,{className:"block mb-6",children:["There was an error logging in to ",s.appName,".",e.jsx("br",{}),"Please try again."]}),e.jsx(d,{type:"default",onClick:()=>window.close(),children:"Close Window"})]})}):e.jsxs(x,{className:"max-w-sm w-full shadow-2xl",title:"Connect a Device",children:[e.jsx(Q,{children:"Enter the code displayed on your device."}),e.jsxs(I,{layout:"vertical",onFinish:a=>{u(a.code),l("device_code"),f(!0),S().catch(()=>{r.error("Failed to fetch SSO details with provided code"),u(null)}).finally(()=>{f(!1)})},children:[e.jsx(I.Item,{name:"code",label:"Device Code",rules:[{required:!0,message:"Please enter the code"}],children:e.jsx(Y,{placeholder:"ABCD1234",size:"large",className:"text-center tracking-widest uppercase font-mono",maxLength:8,onChange:a=>{a.target.value=a.target.value.toUpperCase()}})}),e.jsx(d,{type:"primary",htmlType:"submit",block:!0,size:"large",children:"Continue"})]})]})}export{oe as default};
