import{n as ie,h as fe,m as je,v as T,y as we,E as ve,F as ke,G as K,d as f,b as Ne,A as Ce,r as o,c as j,j as e,e as Se,M as Pe,B as p,H as B,L as q,f as J,g as X}from"./index-D5_mLI82.js";import{F as ze,I as Ie}from"./FailedView-TeKyp3Wp.js";import{U as $e,R as Fe,f as Q,D as Me,F as be,M as Z}from"./date--KelkOEv.js";import{s as G}from"./crypto-B9Mf35RN.js";import{F as g,R as ee,C as V,I as v}from"./index-CSxyuTlK.js";import{C as se}from"./index-CyZYTLy1.js";import{i as ae,S as i,R as te}from"./TextArea-BH2ReUaC.js";import{T as Ee,R as O}from"./index-C3jrg75r.js";import{D as re}from"./index-DqNEsMew.js";import{K as Ae}from"./key-round-D3nTrPz-.js";import"./index-BlQXMu7v.js";const ce=["wrap","nowrap","wrap-reverse"],oe=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],de=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"],Le=(a,t)=>{const r=t.wrap===!0?"wrap":t.wrap;return{[`${a}-wrap-${r}`]:r&&ce.includes(r)}},Re=(a,t)=>{const r={};return de.forEach(l=>{r[`${a}-align-${l}`]=t.align===l}),r[`${a}-align-stretch`]=!t.align&&!!t.vertical,r},Ue=(a,t)=>{const r={};return oe.forEach(l=>{r[`${a}-justify-${l}`]=t.justify===l}),r},_e=(a,t)=>ie({...Le(a,t),...Re(a,t),...Ue(a,t)}),De=a=>{const{componentCls:t}=a;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},Te=a=>{const{componentCls:t}=a;return{[t]:{"&-gap-small":{gap:a.flexGapSM},"&-gap-middle":{gap:a.flexGap},"&-gap-large":{gap:a.flexGapLG}}}},qe=a=>{const{componentCls:t}=a,r={};return ce.forEach(l=>{r[`${t}-wrap-${l}`]={flexWrap:l}}),r},Ge=a=>{const{componentCls:t}=a,r={};return de.forEach(l=>{r[`${t}-align-${l}`]={alignItems:l}}),r},Ve=a=>{const{componentCls:t}=a,r={};return oe.forEach(l=>{r[`${t}-justify-${l}`]={justifyContent:l}}),r},Oe=()=>({}),He=fe("Flex",a=>{const{paddingXS:t,padding:r,paddingLG:l}=a,h=je(a,{flexGapSM:t,flexGap:r,flexGapLG:l});return[De(h),Te(h),qe(h),Ge(h),Ve(h)]},Oe,{resetStyle:!1}),H=T.forwardRef((a,t)=>{const{prefixCls:r,rootClassName:l,className:h,style:m,flex:k,gap:x,vertical:b,orientation:E,component:I="div",children:A,...N}=a,{flex:C,direction:L,getPrefixCls:R}=T.useContext(we),u=R("flex",r),[U,$]=He(u),[,S]=ve(E,b??C?.vertical),P=ie(h,l,C?.className,u,U,$,_e(u,a),{[`${u}-rtl`]:L==="rtl",[`${u}-gap-${x}`]:ae(x),[`${u}-vertical`]:S}),y={...C?.style,...m};return K(k)&&(y.flex=k),K(x)&&!ae(x)&&(y.gap=x),T.createElement(I,{ref:t,className:P,style:y,...ke(N,["justify","wrap","align"])},A)});const We=[["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}],["path",{d:"M10 4v4",key:"pp8u80"}],["path",{d:"M2 8h20",key:"d11cs7"}],["path",{d:"M6 4v4",key:"1svtjw"}]],ne=f("app-window",We);const Ye=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],Ke=f("circle-user",Ye);const Be=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Je=f("clock",Be);const Xe=[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]],Qe=f("id-card",Xe);const Ze=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],le=f("mail",Ze);const es=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ss=f("plus",es);const as=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],ts=f("shield",as);const rs=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ns=f("tag",rs),{Title:ls,Text:c}=Ee;function fs(){const{profile:a,myApps:t,fetchMyApps:r,updateProfile:l,isLoadingProfile:h}=Ne(),{message:m}=Ce.useApp(),[k,x]=o.useState(null),[b,E]=o.useState([]),[I,A]=o.useState([]),[N,C]=o.useState(null);o.useEffect(()=>{r(),L()},[]),o.useEffect(()=>{R(N)},[N]);const L=async()=>{try{const{data:s}=await j.get("/user/apps/summary");A(s.data||[])}catch{}},R=async s=>{try{let n="/user/history";if(s){const z=s.format("YYYY-MM-DD"),ge=s.utcOffset();n+=`?date=${z}&offset=${ge}`}const{data:d}=await j.get(n);E(d.data||[])}catch{}},[u,U]=o.useState({avatar:!1,nickname:!1}),[$,S]=o.useState(""),[P,y]=o.useState(""),[W,Y]=o.useState(null);o.useEffect(()=>{r()},[]),o.useEffect(()=>{a&&(S(a.nickname||""),y(a.avatarUrl||""))},[a]);const w=(s,n)=>{U(d=>({...d,[s]:n})),s==="nickname"&&S(a?.nickname||""),s==="avatar"&&y(a?.avatarUrl||"")},me=async()=>{const s=$.trim();if(!s){m.warning("nickname cannot be empty");return}x("nickname");try{const{data:n}=await j.post("/profile/nickname",{nickname:s});l({nickname:s}),m.success(n?.message||"nickname updated"),w("nickname",!1)}catch(n){const d=n;m.error(d.response?.data?.error||"Could not update nickname")}finally{x(null)}},pe=async()=>{x("avatar");try{let s;if(W){const d=new FormData;d.append("file",W);const{data:z}=await j.post("/profile/avatar",d,{headers:{"Content-Type":"multipart/form-data"}});s=z}else{const d=P.trim(),{data:z}=await j.post("/profile/avatar",{avatarUrl:d});s=z}let n=s.data?.avatarUrl||P;n.startsWith("/blob/")&&X.API_URL&&(n=X.API_URL.replace(/\/$/,"")+n),l({avatarUrl:n}),m.success(s?.message||"Avatar updated"),w("avatar",!1),Y(null)}catch(s){const n=s;m.error(n.response?.data?.error||"Could not update avatar")}finally{x(null)}},[xe,_]=o.useState(!1),[F]=g.useForm(),[he,D]=o.useState(!1),[M]=g.useForm(),ue=async()=>{try{const s=await F.validateFields();await j.post("/profile/password",{currentPassword:await G(s.currentPassword),newPassword:await G(s.newPassword)}),m.success("Password updated successfully"),_(!1),F.resetFields()}catch(s){const n=s;m.error(n.response?.data?.error||"Failed to update password")}},ye=async()=>{try{const s=await M.validateFields();await j.post("/profile/email/change",{password:await G(s.password),newEmail:s.newEmail}),m.success("Verification email sent to new address"),D(!1),M.resetFields()}catch(s){const n=s;m.error(n.response?.data?.error||"Failed to request email change")}};return h?e.jsx(Se,{}):a?e.jsxs(se,{className:"max-w-4xl w-full shadow-xl",children:[e.jsx(H,{justify:"space-between",align:"center",wrap:!0,children:e.jsxs(i,{orientation:"vertical",size:4,children:[e.jsx(ls,{level:3,className:"m-0",children:"Dashboard"}),e.jsx(c,{type:"secondary",children:"Manage your profile and credentials"})]})}),e.jsx(re,{className:"my-6"}),e.jsxs(ee,{gutter:[24,24],align:"stretch",children:[e.jsx(V,{xs:24,sm:9,children:e.jsxs(i,{orientation:"vertical",size:16,className:"w-full p-4",children:[e.jsx(Pe,{size:96}),e.jsx(c,{strong:!0,className:"text-xl",children:a?.nickname||a?.username||"—"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(i,{align:"center",size:10,children:[e.jsx(Qe,{className:"text-primary-500",size:16}),e.jsx(c,{children:a?.username||"—"})]}),e.jsxs(i,{align:"center",size:10,children:[e.jsx(le,{className:"text-primary-500",size:16}),e.jsx(c,{children:a?.email||"—"})]})]})]})}),e.jsx(V,{xs:24,sm:15,children:e.jsxs(i,{orientation:"vertical",size:32,className:"w-full p-4",children:[e.jsxs("div",{children:[e.jsxs(i,{align:"center",size:12,children:[e.jsx(ns,{className:"text-primary-500",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Nickname"})]}),e.jsx("div",{className:"mt-[14px]",children:u.nickname?e.jsxs(i.Compact,{children:[e.jsx(v,{value:$,onChange:s=>S(s.target.value),placeholder:"Set a nickname",className:"min-w-[190px]"}),e.jsx(p,{type:"primary",icon:e.jsx(te,{}),loading:k==="nickname",onClick:me}),e.jsx(p,{icon:e.jsx(B,{}),type:"default",onClick:()=>w("nickname",!1)})]}):e.jsxs(i,{align:"center",children:[e.jsx(c,{type:"secondary",children:a?.nickname||"No nickname set"}),e.jsx(p,{type:"link",icon:e.jsx(O,{}),onClick:()=>w("nickname",!0),children:"Update"})]})})]}),e.jsxs("div",{children:[e.jsxs(i,{align:"center",size:12,children:[e.jsx(Ke,{className:"text-primary-500",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Avatar"})]}),e.jsx("div",{className:"mt-[14px]",children:u.avatar?e.jsxs(i,{children:[e.jsxs(i.Compact,{children:[e.jsx(v,{value:P,onChange:s=>y(s.target.value),placeholder:"https://example.com/avatar.jpg",className:"min-w-[220px]"}),e.jsx(p,{type:"primary",icon:e.jsx(te,{}),loading:k==="avatar",onClick:pe}),e.jsx(p,{icon:e.jsx(B,{}),type:"default",onClick:()=>w("avatar",!1)})]}),e.jsx(Ie,{rotationSlider:!0,children:e.jsx($e,{showUploadList:!1,customRequest:({file:s,onSuccess:n})=>{const d=s;Y(d),y(URL.createObjectURL(d)),m.info("Image selected. Click check to save."),n?.("ok")},children:e.jsx(p,{icon:e.jsx(Fe,{}),children:"Select"})})})]}):e.jsxs(i,{wrap:!0,align:"center",children:[e.jsx(c,{type:"secondary",children:a?.avatarUrl?"Custom URL linked":"No avatar set"}),e.jsx(p,{type:"link",icon:e.jsx(O,{}),onClick:()=>w("avatar",!0),children:"Update"})]})})]}),e.jsxs("div",{children:[e.jsxs(i,{align:"center",size:12,children:[e.jsx(le,{className:"text-primary-500",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Email"})]}),e.jsxs("div",{className:"mt-[14px]",children:[e.jsx(c,{type:"secondary",className:"mr-4",children:a?.email||"No Email"}),e.jsx(p,{type:"link",icon:e.jsx(O,{}),onClick:()=>D(!0),className:"pl-0",children:"Change Email"})]})]}),e.jsxs("div",{children:[e.jsxs(i,{align:"center",size:12,children:[e.jsx(Ae,{className:"text-primary-500",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Password"})]}),e.jsxs("div",{className:"mt-[14px]",children:[e.jsx(p,{type:"link",onClick:()=>_(!0),className:"pl-0",children:"Change Password"}),e.jsx(q,{to:"/forget",className:"ml-4",children:"Forgot Password"})]})]}),e.jsxs("div",{children:[e.jsxs(i,{align:"center",size:12,children:[e.jsx(ne,{className:"text-primary-500",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"My Applications"})]}),e.jsxs("div",{className:"mt-[14px] flex flex-wrap gap-2",children:[t.map(s=>e.jsx(q,{to:s.name==="system"?"/manage":`/manage/${s.appId}`,children:e.jsxs(p,{children:[s.name==="system"?e.jsx(ts,{size:14}):e.jsx(J,{size:20,url:{url:s.logoUrl,text:s.name}})," ",s.name]})},s.appId)),e.jsx(q,{to:"/apps/create",children:e.jsxs(p,{type:"dashed",children:[e.jsx(ss,{size:14}),"Create New App"]})})]})]})]})})]}),e.jsx(re,{className:"my-6"}),e.jsxs(i,{orientation:"vertical",style:{width:"100%"},className:"mb-8",children:[e.jsxs(i,{align:"center",size:12,children:[e.jsx(ne,{className:"text-primary-500",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Applications Logged Into"})]}),e.jsxs(ee,{gutter:[16,16],className:"mt-4",children:[I.map(s=>e.jsx(V,{xs:24,sm:12,md:8,lg:6,children:e.jsx(se,{size:"small",className:"hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(H,{align:"center",gap:10,children:[e.jsx(J,{url:{url:s.logoUrl,text:s.app},size:"small"}),e.jsx(c,{strong:!0,children:s.app})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Last Login: ",e.jsx("br",{}),Q(s.time)]})]})})},s.app)),I.length===0&&e.jsx(c,{type:"secondary",className:"pl-4",children:"No login history found."})]})]}),e.jsxs(i,{orientation:"vertical",style:{width:"100%"},children:[e.jsxs(H,{justify:"space-between",align:"center",children:[e.jsxs(i,{align:"center",size:12,children:[e.jsx(Je,{className:"text-primary-500",size:16}),e.jsx(c,{strong:!0,className:"text-base",children:"Login History"})]}),e.jsx(Me,{value:N,onChange:C,placeholder:"Select Date",allowClear:!0})]}),e.jsx(be,{dataSource:b,rowKey:s=>s.time+s.app+Math.random(),pagination:{pageSize:5},size:"small",locale:{emptyText:"No history found"},columns:[{title:"Application",dataIndex:"app",key:"appName"},{title:"Time",dataIndex:"time",key:"time",render:s=>Q(s)}]})]}),e.jsx(Z,{title:"Change Password",open:xe,onOk:ue,onCancel:()=>{_(!1),F.resetFields()},children:e.jsxs(g,{form:F,layout:"vertical",children:[e.jsx(g.Item,{name:"currentPassword",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:e.jsx(v.Password,{})}),e.jsx(g.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please enter a new password"},{min:8,message:"Password must be at least 8 characters"}],children:e.jsx(v.Password,{})})]})}),e.jsx(Z,{title:"Change Email",open:he,onOk:ye,onCancel:()=>{D(!1),M.resetFields()},children:e.jsxs(g,{form:M,layout:"vertical",children:[e.jsx(g.Item,{name:"newEmail",label:"New Email",rules:[{required:!0,message:"Please enter your new email"},{type:"email",message:"Please enter a valid email"}],children:e.jsx(v,{})}),e.jsx(g.Item,{name:"password",label:"Current Password",rules:[{required:!0,message:"Please enter your current password"}],children:e.jsx(v.Password,{})})]})})]}):e.jsx(ze,{})}export{fs as default};
