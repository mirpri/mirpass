import{r as c,u as L,a as R,b,s as d,j as e,B as E,L as j,c as F}from"./index-BgHobQkF.js";import{s as $}from"./crypto-Cw3CO9Ve.js";import{C as k}from"./index-BELaRMtZ.js";import{S as u}from"./TextArea-DDzZaqeS.js";import{T as C}from"./index-CpYTIEz2.js";import{F as l,I as w}from"./index-BoaVPCjC.js";import{R as N}from"./UserOutlined-CBI5NnIO.js";import{R as T}from"./LockOutlined-DBdfNnPU.js";const{Title:U,Text:y}=C;function J({onLogin:S,isAuthenticated:p}){const[I,f]=c.useState(!1),t=L(),[a,h]=R(),{ssoSessionId:P,setSsoSessionId:g}=b(),n=a.get("sso"),o=a.get("from");c.useEffect(()=>{n&&g(n)},[n,g]);const r=n||P;c.useEffect(()=>{if(p)if(r){const s=o?`&from=${encodeURIComponent(o)}`:"";t(`/authorize?sso=${r}${s}`,{replace:!0})}else t("/dashboard",{replace:!0})},[p,r,o,t]),c.useEffect(()=>{if(a.get("verified")==="true"){d.success("Email verified. You can log in now.");const s=new URLSearchParams(a);s.delete("verified"),h(s,{replace:!0})}},[a,h]);const v=async s=>{f(!0);try{const m={...s,password:await $(s.password)},{data:i}=await F.post("/login",m),x=i?.data?.token;if(!x)throw new Error("Missing token from server response");if(d.success(i?.message||"Logged in"),S(x),r){const z=o?`&from=${encodeURIComponent(o)}`:"";t(`/authorize?sso=${r}${z}`,{replace:!0})}}catch(m){const i=m;d.error(i.response?.data?.message||"Failed to login")}finally{f(!1)}};return e.jsx(k,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs(u,{orientation:"vertical",size:"large",className:"w-full",children:[e.jsxs(u,{orientation:"vertical",size:4,children:[e.jsx(U,{level:3,className:"m-0",children:"Login"}),e.jsx(y,{type:"secondary",children:r?"Sign in to continue to external app":"Login to continue to your dashboard"})]}),e.jsxs(l,{layout:"vertical",onFinish:v,requiredMark:!1,children:[e.jsx(l.Item,{label:"Username",name:"username",rules:[{required:!0,message:"Please enter your username"}],children:e.jsx(w,{size:"large",prefix:e.jsx(N,{}),placeholder:"Username"})}),e.jsx(l.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please enter your password"}],children:e.jsx(w.Password,{size:"large",prefix:e.jsx(T,{}),placeholder:"••••••••",autoComplete:"current-password"})}),e.jsx(l.Item,{children:e.jsx(E,{type:"primary",htmlType:"submit",size:"large",block:!0,loading:I,children:"Sign in"})})]}),e.jsxs(u,{orientation:"vertical",size:4,children:[e.jsxs(y,{type:"secondary",children:["New here? ",e.jsx(j,{to:"/register",children:"Create an account"})]}),e.jsx(j,{to:"/forget",children:"Forgot Password?"})]})]})})}export{J as default};
