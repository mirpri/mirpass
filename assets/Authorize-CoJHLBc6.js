import{d as N,u as E,a as F,A as U,b as D,r as h,j as e,e as q,B as n,f as L,M as O,g as M}from"./index-D5_mLI82.js";import{C as x}from"./index-CyZYTLy1.js";import{T as R}from"./index-C3jrg75r.js";import{F as _,I as B}from"./index-CSxyuTlK.js";import{S as W}from"./TextArea-BH2ReUaC.js";import{D as z}from"./index-DqNEsMew.js";const Y=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],V=N("arrow-right",Y);const X=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],G=N("circle-check",X);const H=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],J=N("circle-x",H),{Title:w,Text:l,Paragraph:K}=R;function re(){const v=E(),[p]=F(),{message:d}=U.useApp(),{ssoDetails:s,fetchSsoDetails:C,ssoConfirm:A,profile:S,token:f,logout:I,ssoSessionId:g,setSsoSessionId:o,ssoType:$,setSsoType:c,ssoUserCode:P,setSsoUserCode:m}=D(),u=p.get("session_id"),y=p.get("from"),t=p.get("user_code"),r=u||g,[k,j]=h.useState(!1);h.useEffect(()=>{u&&(o&&u!==g&&o(u),c&&c("auth_code"))},[u,g,o,c]),h.useEffect(()=>{t&&(c&&c("device_code"),m&&m(t))},[t,c,m]),h.useEffect(()=>{if(!f&&(r||t)){const a=y?`&from=${encodeURIComponent(y)}`:"",i=[];r&&i.push(`session_id=${r}`),t&&i.push(`user_code=${t}`);const T=i.length>0?`?${i.join("&")}${a}`:"";v(`/login${T}`,{replace:!0})}},[f,r,t,y,v,s]),h.useEffect(()=>{f&&(r||t)&&C().catch(a=>{console.error("Failed to fetch SSO details",a);const i=a;d.error(i.response?.data?.error||"Failed to fetch SSO details"),o&&o(null)})},[]);const b=async()=>{if(!s||!r){d.error("Missing SSO session details");return}if(j(!0),$==="auth_code"){window.location.href=`${M.API_URL}/authorize/consent/redirect?sessionId=${r}&approve=true`,j(!1);return}try{await A(!0),d.success(`Logged in to ${s?.appName}`),o&&o(null)}catch{d.error("Failed to confirm login")}finally{j(!1)}};return!s&&(r||P)?e.jsx(q,{}):s?s.status==="authorized"||s.status==="consumed"?e.jsx(x,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{className:"text-green-500 mb-4 mx-auto",size:64}),e.jsx(w,{level:3,children:"Success!"}),e.jsxs(l,{className:"block mb-6",children:["You have logged in to ",s.appName,".",e.jsx("br",{}),"You can close this window now."]}),e.jsx(n,{type:"default",onClick:()=>window.close(),children:"Close Window"})]})}):s.status==="pending"?e.jsx(x,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs(W,{orientation:"vertical",size:"large",className:"w-full text-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(L,{size:64,url:{url:s.logoUrl,text:s.appName},className:"m-5"}),e.jsx(w,{level:3,className:"m-0",children:s.appName}),e.jsx(l,{type:"secondary",children:"wants to access your account"})]}),e.jsx(z,{className:"my-2"}),e.jsxs("div",{className:"text-left bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-4",children:[e.jsx(l,{type:"secondary",className:"text-xs uppercase font-bold tracking-wider",children:"Signed in as"}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(O,{}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(l,{strong:!0,children:S?.nickname}),e.jsx(l,{type:"secondary",children:S?.username})]})]})]}),e.jsxs(n,{type:"primary",size:"large",block:!0,onClick:b,loading:k,children:[e.jsx(V,{}),"Continue to ",s.appName]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(n,{type:"text",onClick:I,children:"Change Account"}),e.jsx(z,{type:"vertical"}),e.jsx(n,{type:"text",danger:!0,onClick:b,loading:k,children:"Cancel"})]})]})}):e.jsx(x,{className:"max-w-sm w-full shadow-2xl",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:" text-red-500 mb-4 mx-auto",size:64}),e.jsx(w,{level:3,children:"Error!"}),e.jsxs(l,{className:"block mb-6",children:["There was an error logging in to ",s.appName,".",e.jsx("br",{}),"Please try again or contact support."]}),e.jsx(n,{type:"default",onClick:()=>window.close(),children:"Close Window"})]})}):e.jsxs(x,{className:"max-w-sm w-full shadow-2xl",title:"Connect a Device",children:[e.jsx(K,{children:"Enter the code displayed on your device."}),e.jsxs(_,{layout:"vertical",onFinish:a=>{m(a.code),c("device_code"),C().catch(()=>{d.error("Failed to fetch SSO details with provided code"),m(null)})},children:[e.jsx(_.Item,{name:"code",label:"Device Code",rules:[{required:!0,message:"Please enter the code"}],children:e.jsx(B,{placeholder:"ABCD1234",size:"large",className:"text-center tracking-widest uppercase font-mono",maxLength:8,onChange:a=>{a.target.value=a.target.value.toUpperCase()}})}),e.jsx(n,{type:"primary",htmlType:"submit",block:!0,size:"large",children:"Continue"})]})]})}export{re as default};
